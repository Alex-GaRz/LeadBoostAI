
import React from 'react';
import { IaData, CampaignData } from './DashboardCampaignTabs';

interface AdPreviewProps {
	platform: string;
	iaData: IaData | null;
	campaignData: CampaignData | undefined;
	variant?: number;
	businessName?: string;
}

const AdPreview: React.FC<AdPreviewProps> = ({ platform, iaData, campaignData, variant, businessName }) => {
	// Helper para obtener los datos de la variante
	const getVar = (n: 1 | 2 | 3) => iaData?.["Anuncio generado por IA"]?.[`Variante ${n}`] || {};

	// Si se pasa variant, solo mostrar esa variante
	const variantsToShow = variant ? [variant] : [1, 2, 3];

		return (
			<div className="w-full h-full flex flex-col gap-6 justify-stretch items-stretch">
				{/* Vista previa para Meta Ads */}
						{platform === 'Meta Ads' && iaData && (
							<>
								{variantsToShow.map((v) => {
									const variante = getVar(v as 1 | 2 | 3);
									let brand = "Nombre de marca";
									if (businessName) {
										brand = String(businessName);
									}
									const patrocinado = "Patrocinado";
									const textoPrincipal = variante["Texto principal"] || iaData["Texto principal"] || "Sin texto principal";
									const titulo = variante["T√≠tulo del anuncio"] || iaData["T√≠tulo del anuncio"] || "Sin t√≠tulo";
									const cta = variante["CTA"] || iaData["CTA"] || "Pedir m√°s informaci√≥n";

									let imagenUrl = null;
									if (campaignData?.recursos === 'Ya tengo un anuncio hecho') {
										imagenUrl = campaignData.user_image_url;
									} else if (campaignData?.recursos === 'Tengo fotos o videos de mis productos' || campaignData?.recursos === 'No tengo nada, que la IA lo cree desde cero') {
										imagenUrl = campaignData.generated_image_url;
									}

									return (
																<div key={v} className="flex flex-col h-full w-full border rounded-xl bg-white shadow mb-4 max-w-xl mx-auto" style={{fontFamily:'inherit'}}>
																	{/* Header */}
																	<div className="flex items-center justify-between px-4 pt-4 pb-2">
																		<div className="flex items-center gap-3">
																			<div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-2xl">
																				<span role="img" aria-label="avatar">ü¶∂</span>
																			</div>
																			<div>
																				<div className="font-semibold text-gray-900 leading-tight text-sm">{brand}</div>
																				<div className="text-xs text-gray-500 -mt-1">{patrocinado}</div>
																			</div>
																		</div>
																		<div className="text-gray-400 text-xl font-bold cursor-pointer">...</div>
																	</div>
																	{/* Texto principal */}
																	<div className="px-4 pb-2 text-gray-800 text-base">
																		{textoPrincipal}
																	</div>
																	{/* Imagen */}
																	<div className="w-full aspect-[1.91/1] bg-gray-200 flex items-center justify-center overflow-hidden">
																		{imagenUrl ? (
																			<img src={imagenUrl} alt="Imagen anuncio" className="object-cover w-full h-full" />
																		) : (
																			<span className="text-gray-400">Imagen aqu√≠</span>
																		)}
																	</div>
																	{/* T√≠tulo */}
																	<div className="px-4 pt-3 pb-2">
																		<div className="font-bold text-lg text-gray-900">{titulo}</div>
																	</div>
																	{/* Bot√≥n CTA */}
																	<div className="px-4 pb-3">
																		<button className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg text-base transition-colors">
																			{cta}
																		</button>
																	</div>
																	{/* Acciones sociales */}
																	<div className="flex items-center justify-between border-t px-4 py-2 text-gray-500 text-sm">
																		<div className="flex gap-6">
																			<span className="cursor-pointer hover:text-blue-600">Me gusta</span>
																			<span className="cursor-pointer hover:text-blue-600">Comentar</span>
																			<span className="cursor-pointer hover:text-blue-600">Compartir</span>
																		</div>
																	</div>
																</div>
															);
								})}
							</>
						)}

				{/* Vista previa para Google Ads */}
				   {platform === 'Google Ads' && iaData && (
					   <>
						   {variantsToShow.map((v) => {
							   const variante = getVar(v as 1 | 2 | 3);
							   // Mostrar solo la imagen generada si existe
							   let imagenUrl = null;
							   if (campaignData?.generated_image_url) {
								   imagenUrl = campaignData.generated_image_url;
							   }
							   return (
								   <div key={v} className="flex flex-col h-full w-full border rounded-lg bg-white p-4 shadow mb-2 justify-between items-stretch">
									   {imagenUrl && (
										   <div className="w-full aspect-[1.91/1] bg-gray-200 flex items-center justify-center overflow-hidden mb-2">
											   <img src={imagenUrl} alt="Imagen anuncio" className="object-cover w-full h-full" />
										   </div>
									   )}
									   <div className="font-bold text-lg text-[#2d4792] mb-1">{variante["T√≠tulo del anuncio"] || 'Sin t√≠tulo'}</div>
									   <div className="text-gray-700 mb-2">{variante["Texto principal"] || 'Sin texto principal'}</div>
									   <div className="text-sm text-gray-500 mb-2 italic">{variante["Ideas de im√°genes/videos"] || ''}</div>
									   <div className="flex flex-wrap gap-2 mb-2">
										   {(variante["Formatos sugeridos"] || []).map((f: string) => (
											   <span key={f} className="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs">{f}</span>
										   ))}
									   </div>
									   <div className="flex flex-wrap gap-2 mb-2">
										   {(variante["Audiencias personalizadas/lookalikes"] || []).map((a: string) => (
											   <span key={a} className="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">{a}</span>
										   ))}
									   </div>
									   <div className="mt-2">
										   <span className="font-semibold text-[#2d4792]">CTA:</span> {variante["CTA"] || '-'}
									   </div>
								   </div>
							   );
						   })}
					   </>
				   )}
			</div>
		);
};

export default AdPreview;

